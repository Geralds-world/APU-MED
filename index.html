<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APU | Emergency & First Aid Supplies</title>
<script src="https://js.yoco.com/sdk/v1/yoco.js"></script>


<style>
* {margin:0;padding:0;box-sizing:border-box}
body{
  background:#f8fafc;
  color:#1e293b;
  font-family:'Segoe UI',system-ui;
  line-height:1.6
}

/* HEADER */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 50px;
  background:#0b2c32d8;
  position:sticky;
  top:0;
  z-index:100;
  border-bottom:4px solid #0ea5a4;
  box-shadow:0 4px 16px rgba(14,165,164,0.15)
}
header h2{
  color: #ffffff;
  font-size: 2rem;
  letter-spacing: 2px;
  font-weight: 700;
text-shadow:
  -2px 0 4px rgba(14,165,164,0.9),
   2px 0 4px rgba(239,68,68,0.9);
}

nav{display:flex;gap:30px;align-items:center}
nav a{
  color:#ffffff;
  text-decoration:none;
  transition:.3s;
  font-weight:500;
  font-size:1.05rem
}
nav a:hover{color:#0ea5a4}

/* HERO */
.hero{
  min-height:700px;
  background:linear-gradient(135deg,rgba(14,165,164,0.15),rgba(59,130,246,0.1));
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:50px;
  position:relative;
  overflow:hidden;
  border-radius: 20px;
  margin-top: 20px;
}
.hero video{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;opacity:0.4}
.hero::before{
  content:'';
  position:absolute;
  inset:0;
  background:rgba(37, 41, 44, 0.85);

}
.hero-content{position:relative;z-index:2;max-width:900px}
.hero h1{
  font-size:4rem;
  font-weight:700;
  margin-bottom:20px;
  background:linear-gradient(135deg,#0ea5a4,#2563eb);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  line-height:1.2
}
.hero p{
  font-size:1.8rem;
  color:#ffffff;
  margin-bottom:30px;
  font-weight:300
}

.cta-button{
  padding:18px 50px;
  background:linear-gradient(90deg,#0ea5a4,#2563eb);
  color:#ffffff;
  border:none;
  border-radius:8px;
  font-size:1.2rem;
  font-weight:700;
  cursor:pointer;
  transition:.3s
}
.cta-button:hover{
  transform:translateY(-3px);
  box-shadow:0 20px 40px rgba(37,99,235,0.3)
}

/* SECTIONS */
section{padding:80px 50px;max-width:1400px;margin:auto}
section h2{
  font-size:3rem;
  margin-bottom:50px;
  color:#0ea5a4;
  border-bottom:3px solid #2563eb;
  padding-bottom:20px;
  letter-spacing:1px
}
section h3{font-size:1.8rem;margin-bottom:30px;color:#334155}

/* ABOUT */
.about-content{display:grid;grid-template-columns:1fr 1fr;gap:60px;align-items:center;margin-bottom:50px}
.about-text h3{color:#0ea5a4;font-size:1.8rem;margin-bottom:25px}
.about-text p{
  font-size:1.1rem;
  color:#475569;
  margin-bottom:20px;
  line-height:1.9
}
.values{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:25px;margin-top:40px}
.value-card{
  background:#ffffff;
  padding:30px;
  border-radius:12px;
  border-left:5px solid #0ea5a4;
  box-shadow:0 10px 30px rgba(0,0,0,0.05);
  transition:.3s
}
.value-card:hover{
  transform:translateY(-5px);
  box-shadow:0 15px 40px rgba(14,165,164,0.25)
}
.value-card h4{color:#0ea5a4;margin-bottom:15px;font-size:1.3rem}
.value-card p{color:#64748b;font-size:1rem;line-height:1.7}

/* CATEGORIES */
.category-section{margin-bottom:60px}
.category-header{
  background:linear-gradient(90deg,#e0f2fe,#f0fdfa);
  padding:20px 25px;
  border-radius:12px;
  cursor:pointer;
  border-left:5px solid #0ea5a4;
  display:flex;
  justify-content:space-between;
  align-items:center;
  transition:.3s
}
.category-header:hover{
  box-shadow:0 10px 25px rgba(14,165,164,0.2)
}
.category-header h3{color:#0ea5a4;margin:0;font-size:1.5rem}
.category-toggle{color:#2563eb;font-weight:700;font-size:1.3rem;transition:.3s}
.category-toggle.active{transform:rotate(180deg)}

/* PRODUCTS */
.products{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:25px;
  margin-top:30px;
  overflow:visible;
  transition:max-height .4s ease;
  max-height:none
}
.products.collapsed{max-height:0;margin-top:0;overflow:hidden}
.product{
  background:#ffffff;
  border-radius:14px;
  padding:20px;
  border:1px solid #e2e8f0;
  box-shadow:0 10px 25px rgba(0,0,0,0.05);
  transition:.3s
}
.product:hover{
  transform:translateY(-8px);
  box-shadow:0 20px 45px rgba(37,99,235,0.25);
  border-color:#0ea5a4
}
.product img{width:100%;height:220px;object-fit:cover;border-radius:8px;margin-bottom:12px}
.product.onthego-item img{height:320px}
.product.emergency-item img{height:280px}
.product.bandage-item img{height:280px}
.product.refill-item img{height:160px}
.product h4{color:#1e293b;margin:12px 0 8px;font-size:1.05rem;font-weight:600}
.product strong{color:#0ea5a4;font-size:1.3rem;display:block;margin-bottom:15px}

/* BUTTON */
.btn{
  width:100%;
  padding:12px;
  border:none;
  border-radius:8px;
  background:linear-gradient(90deg,#0ea5a4,#2563eb);
  font-weight:700;
  cursor:pointer;
  color:#ffffff;
  margin-top:10px;
  transition:.3s;
  text-transform:uppercase;
  letter-spacing:0.5px
}
.btn:hover{opacity:0.95;transform:scale(1.02)}

/* CART */
.cart{
  position:fixed;
  right:0;
  top:0;
  width:380px;
  height:100%;
  background:#ffffff;
  padding:25px;
  transform:translateX(110%);
  transition:.3s;
  z-index:1000;
  border-left:3px solid #0ea5a4;
  box-shadow:-10px 0 30px rgba(0,0,0,0.15);
  overflow-y:auto
}
.cart.active{transform:translateX(0)}
.cart h3{color:#0ea5a4;margin-bottom:25px;font-size:1.5rem}
.cart p{color:#334155;margin:12px 0}
.warning{
  color:#b45309;
  background:#fffbeb;
  padding:12px;
  border-radius:6px;
  border-left:4px solid #f59e0b;
  font-weight:600;
  font-size:0.95rem
}
.cart-item{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  padding:15px;
  background:#f8fafc;
  margin:12px 0;
  border-radius:8px;
  font-size:0.95rem;
  gap:10px;
  border-left:3px solid #0ea5a4
}
.cart-item-info{flex:1}
.delete-btn{
  background:#ef4444;
  color:#fff;
  border:none;
  padding:6px 10px;
  border-radius:4px;
  cursor:pointer;
  font-size:0.8rem;
  font-weight:600;
  white-space:nowrap
}
.delete-btn:hover{background:#dc2626}

/* FOOTER */
footer{
  background:linear-gradient(90deg,rgba(14,165,164,0.1),rgba(37,99,235,0.1));
  padding:50px;
  text-align:center;
  border-top:3px solid #0ea5a4;
  color:#334155;
  margin-top:60px
}
footer p{margin:8px 0;font-size:1rem;font-weight:500}
footer strong{color:#0ea5a4}

/* SEARCH BAR */
.search-container{
  display:flex;
  gap:15px;
  margin-bottom:40px;
  max-width:500px
}
.search-input{
  flex:1;
  padding:12px 16px;
  border:2px solid #e2e8f0;
  border-radius:8px;
  font-size:1rem;
  transition:.3s
}
.search-input:focus{
  outline:none;
  border-color:#0ea5a4;
  box-shadow:0 0 0 3px rgba(14,165,164,0.1)
}
.search-input::placeholder{color:#94a3b8}
.clear-search{
  padding:12px 20px;
  background:#f1f5f9;
  border:2px solid #e2e8f0;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  color:#475569;
  transition:.3s
}
.clear-search:hover{background:#e2e8f0}

@media(max-width:1024px){
.hero h1{font-size:2.8rem}
.hero p{font-size:1.4rem}
.cart{width:320px}
section{padding:60px 30px}
}

@media(max-width:768px){
.hero{min-height:500px}
.hero h1{font-size:2rem}
.hero p{font-size:1.2rem}
.about-content{grid-template-columns:1fr}
nav{gap:15px}
section{padding:50px 20px}
.products{grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px}
header{padding:15px 20px}
header h2{font-size:1.5rem}
}
</style>
</head>

<body>

<header>
  <h2>APU</h2>
  <nav>
    <a href="#hero">Home</a>
    <a href="#about">About Us</a>
    <a href="#products">Products</a>
    <a href="#" onclick="toggleCart()">Cart üõí</a>
  </nav>
</header>

<section class="hero" id="hero">
  <video autoplay muted loop playsinline id="heroVideo">
  <source src="/images/APU - loading video.mp4" type="video/mp4">
</video>
  <div class="hero-content">
    <h1>Real Emergencies. Real People. Real Solutions.</h1>
    <p>Being Prepared Can Save a Life</p>
    <button class="cta-button" onclick="document.getElementById('products').scrollIntoView({behavior:'smooth'})">
      Browse Our Supplies
    </button>
  </div>
</section>

<section id="about">
  <h2>About APU</h2>
  <div class="about-content">
    <div class="about-text">
      <h3>Saving Lives, One Kit at a Time</h3>
      <p>
        At APU, we believe that preparation is the cornerstone of survival. Whether you're facing an unexpected injury, a workplace accident, or an emergency situation, having the right supplies on hand can mean the difference between a minor incident and a tragedy.
      </p>
      <p>
        We serve communities across the nation, providing medical professionals, emergency responders, businesses, and concerned citizens with certified, high-quality first aid and emergency supplies. Our mission is simple: to ensure that when seconds count, you're ready.
      </p>
    </div>
    <div class="values">
      <div class="value-card">
        <h4>üè• Quality First</h4>
        <p>Every product is certified and tested to meet international medical standards.</p>
      </div>
      <div class="value-card">
        <h4>‚ö° Always Ready</h4>
        <p>Fast delivery and responsive support when you need us most.</p>
      </div>
      <div class="value-card">
        <h4>üë• Community Care</h4>
        <p>Supporting local communities with affordable, accessible emergency solutions.</p>
      </div>
      <div class="value-card">
        <h4>üìö Education</h4>
        <p>Partnering with first aid trainers to ensure you know how to use your supplies.</p>
      </div>
    </div>
  </div>
</section>

<section id="products">
  <h2>First Aid & Emergency Supplies</h2>
  
  <div class="search-container">
    <input type="text" id="searchInput" class="search-input" placeholder="Search products or categories...">
    <button class="clear-search" onclick="clearSearch()">Clear</button>
  </div>

  <!-- Category Filter Buttons -->
  <div id="categoryButtons" style="display:flex;flex-wrap:wrap;gap:10px;margin-bottom:30px;align-items:center">
    <span style="color:#334155;font-weight:600;margin-right:5px">Filter by:</span>
    <button onclick="filterByCategory('all')" class="category-btn active-cat" style="padding:8px 16px;background:#0ea5a4;color:#ffffff;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:.3s;font-size:0.95rem">All</button>
    <button onclick="filterByCategory('kits')" class="category-btn" style="padding:8px 16px;background:#e2e8f0;color:#334155;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:.3s;font-size:0.95rem">üéí First Aid Kits</button>
    <button onclick="filterByCategory('onthego')" class="category-btn" style="padding:8px 16px;background:#e2e8f0;color:#334155;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:.3s;font-size:0.95rem">üèÉ On-The-Go</button>
    <button onclick="filterByCategory('refills')" class="category-btn" style="padding:8px 16px;background:#e2e8f0;color:#334155;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:.3s;font-size:0.95rem">üìã Refills</button>
    <button onclick="filterByCategory('emergency')" class="category-btn" style="padding:8px 16px;background:#e2e8f0;color:#334155;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:.3s;font-size:0.95rem">üöë Disposable & Emergency</button>
    <button onclick="filterByCategory('tools')" class="category-btn" style="padding:8px 16px;background:#e2e8f0;color:#334155;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:.3s;font-size:0.95rem">üîß Tools</button>
    <button onclick="filterByCategory('plasters')" class="category-btn" style="padding:8px 16px;background:#e2e8f0;color:#334155;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:.3s;font-size:0.95rem">ü©π Plasters</button>
    <button onclick="filterByCategory('tattoo')" class="category-btn" style="padding:8px 16px;background:#e2e8f0;color:#334155;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:.3s;font-size:0.95rem">üé® Tattoo Supplies</button>
  </div>

  <!-- KITS SECTION -->
  <div class="category-section">
    <div class="category-header" onclick="toggleCategory(this)">
      <h3>üéí First Aid Kits</h3>
      <span class="category-toggle">‚ñº</span>
    </div>
    <div class="products kits-products" id="kitsList"></div>
  </div>

  <!-- ON-THE-GO SECTION -->
  <div class="category-section">
    <div class="category-header" onclick="toggleCategory(this)">
      <h3>üèÉ On-The-Go Packs</h3>
      <span class="category-toggle">‚ñº</span>
    </div>
    <div class="products onthego-products" id="onTheGoList"></div>
  </div>

  <!-- REFILLS SECTION -->
  <div class="category-section">
    <div class="category-header" onclick="toggleCategory(this)">
      <h3>üìã First Aid Refills</h3>
      <span class="category-toggle">‚ñº</span>
    </div>
    <div class="products refills-products" id="refillsList"></div>
  </div>

  <!-- DISPOSABLE & EMERGENCY SECTION -->
  <div class="category-section">
    <div class="category-header" onclick="toggleCategory(this)">
      <h3>üöë Disposable & Emergency</h3>
      <span class="category-toggle">‚ñº</span>
    </div>
    <div class="products emergency-products" id="emergencyList"></div>
  </div>

  <!-- TOOLS SECTION -->
  <div class="category-section">
    <div class="category-header" onclick="toggleCategory(this)">
      <h3>üîß Tools & Instruments</h3>
      <span class="category-toggle">‚ñº</span>
    </div>
    <div class="products tools-products" id="toolsList"></div>
  </div>


  <!-- TOOLS SECTION -->
  <div class="category-section">
    <div class="category-header" onclick="toggleCategory(this)">
      <h3>ü©π Plasters</h3>
      <span class="category-toggle">‚ñº</span>
    </div>
    <div class="products plasters-products" id="plastersList"></div>
  </div>

  <!-- TATTOO SUPPLIES SECTION - Hidden by default -->
  <div class="category-section" id="tattooSection" style="display:none">
    <div class="category-header" onclick="toggleCategory(this)">
      <h3>üé® Tattoo Studio Supplies</h3>
      <span class="category-toggle">‚ñº</span>
    </div>
    <div class="products tattoo-products" id="tattooList"></div>
  </div>
</section>

<footer>
  <p><strong>APU</strong> - Emergency & First Aid Supplies</p>
  <p>¬© 2026 All Rights Reserved | Ready. Prepared. Saving Lives.</p>
  <p>For inquiries: <strong>+27 72 335 6685</strong></p>
</footer>

<div class="cart" id="cart">
  <h3>Your Cart</h3>
  <div id="cartItems"></div>
  <p>Total: <strong style="color:#14b8a6">R<span id="total">0</span></strong></p>
  <p class="warning" id="warning"></p>
  <button class="btn" onclick="openDeliveryForm()">Proceed to Payment</button>
  <button class="btn" style="background:linear-gradient(90deg,#64748b,#9ca3af);margin-top:10px" onclick="closeCart()">Close Cart</button>
</div>

<!-- Delivery Address Form Modal -->
<div id="deliveryModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:200;align-items:center;justify-content:center">
  <div style="background:white;padding:40px;border-radius:12px;width:90%;max-width:500px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3)">
    <h2 style="color:#0ea5a4;margin-bottom:15px;text-align:center">Delivery Details</h2>
    
    <!-- Payment Information Banner -->
    <div style="margin-bottom:25px;padding:15px;background:#e0f2fe;border-left:4px solid #0ea5a4;border-radius:6px">
      <p style="color:#0b2c32;font-size:0.95rem;margin:0;line-height:1.6"><strong>üí¨ Payment Method:</strong> You will receive a payment link via WhatsApp. We do not handle payments directly on this website. Our team will contact you with the payment link after confirming your delivery details.</p>
    </div>
    
    <div style="margin-bottom:18px">
      <label style="display:block;margin-bottom:8px;color:#334155;font-weight:600">Full Name *</label>
      <input type="text" id="deliveryName" placeholder="Your full name" style="width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:8px;font-size:1rem;transition:.3s" onfocus="this.style.borderColor='#0ea5a4'" onblur="this.style.borderColor='#e2e8f0'">
    </div>

    <div style="margin-bottom:18px">
      <label style="display:block;margin-bottom:8px;color:#334155;font-weight:600">Phone Number *</label>
      <input type="tel" id="deliveryPhone" placeholder="Your phone number" style="width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:8px;font-size:1rem;transition:.3s" onfocus="this.style.borderColor='#0ea5a4'" onblur="this.style.borderColor='#e2e8f0'">
    </div>

    <div style="margin-bottom:18px">
      <label style="display:block;margin-bottom:8px;color:#334155;font-weight:600">Street Address *</label>
      <input type="text" id="deliveryAddress" placeholder="Street address" style="width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:8px;font-size:1rem;transition:.3s" onfocus="this.style.borderColor='#0ea5a4'" onblur="this.style.borderColor='#e2e8f0'">
    </div>

    <div style="margin-bottom:18px">
      <label style="display:block;margin-bottom:8px;color:#334155;font-weight:600">Postal Code *</label>
      <input type="text" id="deliveryPostal" placeholder="e.g., 0157" style="width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:8px;font-size:1rem;transition:.3s" onfocus="this.style.borderColor='#0ea5a4'" onblur="this.style.borderColor='#e2e8f0'">
    </div>

    <div style="margin-bottom:25px">
      <label style="display:block;margin-bottom:8px;color:#334155;font-weight:600">Area / Suburb</label>
      <input type="text" id="deliveryArea" placeholder="e.g., Knoppieslaagte" style="width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:8px;font-size:1rem;transition:.3s" onfocus="this.style.borderColor='#0ea5a4'" onblur="this.style.borderColor='#e2e8f0'">
    </div>

    <div style="margin-bottom:25px;padding:15px;background:#f0fdf4;border-left:4px solid #10b981;border-radius:6px">
      <p style="color:#166534;font-size:0.95rem;margin:0"><strong>‚ÑπÔ∏è Mnandi Area:</strong> Pick-up FREE or Courier from R50</p>
    </div>

    <label style="display:block;margin-bottom:15px;color:#334155;font-weight:600">Delivery Method *</label>
    <div style="display:grid;gap:12px;margin-bottom:25px">
      <label style="display:flex;align-items:center;padding:12px;border:2px solid #e2e8f0;border-radius:8px;cursor:pointer;transition:.3s" onmouseover="this.style.borderColor='#0ea5a4'" onmouseout="this.style.borderColor='#e2e8f0'">
        <input type="radio" name="delivery" value="pickup" onclick="updateDeliveryEstimate()" style="margin-right:12px;cursor:pointer">
        <span><strong>üìç Pick-up (FREE)</strong><br><span style="font-size:0.9rem;color:#64748b">Mnandi area - will be shared via WhatsApp</span></span>
      </label>
      <label style="display:flex;align-items:center;padding:12px;border:2px solid #e2e8f0;border-radius:8px;cursor:pointer;transition:.3s" onmouseover="this.style.borderColor='#0ea5a4'" onmouseout="this.style.borderColor='#e2e8f0'">
        <input type="radio" name="delivery" value="courier" onclick="updateDeliveryEstimate()" style="margin-right:12px;cursor:pointer">
        <span><strong>üì¶ Courier Delivery</strong><br><span style="font-size:0.9rem;color:#64748b">Estimated fee will show below</span></span>
      </label>
    </div>

    <div id="courierEstimate" style="margin-bottom:25px;padding:15px;background:#fef3c7;border-left:4px solid #f59e0b;border-radius:6px;display:none">
      <p style="color:#92400e;font-size:0.95rem;margin:0"><strong>üì¶ Estimated Courier Fee:</strong> <span id="estimateText">Based on your location (Mnandi: R50, Nearby: R100, Far: R200)</span></p>
    </div>

    <p id="deliveryWarning" style="color:#dc2626;margin-bottom:15px;font-weight:600;text-align:center"></p>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <button onclick="closeDeliveryForm()" style="padding:14px;background:#e2e8f0;border:none;border-radius:8px;cursor:pointer;font-weight:600;color:#334155;transition:.3s" onmouseover="this.style.background='#cbd5e1'" onmouseout="this.style.background='#e2e8f0'">Cancel</button>
      <button onclick="submitDelivery()" style="padding:14px;background:#0ea5a4;border:none;border-radius:8px;cursor:pointer;font-weight:600;color:white;transition:.3s" onmouseover="this.style.background='#0d9488'" onmouseout="this.style.background='#0ea5a4'">Proceed</button>
    </div>
  </div>
</div>

<!-- Item Detail Modal -->
<div id="itemModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:300;align-items:center;justify-content:center;padding:20px">
  <div style="background:white;border-radius:10px;width:96%;max-width:600px;max-height:90vh;overflow:auto;position:relative;padding:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3)">
    <button id="itemModalClose" onclick="closeItemModal()" style="position:absolute;right:12px;top:12px;background:#ef4444;color:white;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;font-weight:700">X</button>
    <div style="display:flex;gap:20px;flex-wrap:wrap;align-items:flex-start;justify-content:center">
      <img id="itemModalMainImage" src="" alt="" style="width:180px;height:180px;object-fit:contain;border:1px solid #e2e8f0;border-radius:8px;background:#fff;padding:8px;flex-shrink:0">
      <div id="itemModalContents" style="flex:1;min-width:220px;">
        <h3 id="itemModalTitle" style="margin:0 0 8px 0;color:#0b2c32"></h3>
        <p id="itemModalCount" style="margin:0 0 12px 0;color:#0ea5a4;font-weight:700"></p>
        <div id="itemModalList" style="display:flex;flex-direction:column;gap:2px;margin-bottom:12px"></div>
        <p id="itemModalDesc" style="color:#334155;margin-bottom:12px"></p>
        <div style="display:flex;gap:10px;align-items:center">
          <button id="itemModalAddBtn" class="btn" onclick="addToCartFromModal()">Add to Cart</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const SELLER_WHATSAPP = "27723356685";
const MIN_ORDER = 80;
const YOCO_BASE_LINK = "https://pay.yoco.com/apocalypse-unit";

/* -------------------- ORDER REFERENCE -------------------- */
function generateOrderRef(){
  let last = parseInt(localStorage.getItem("apuOrderRef") || "0");
  last++;
  localStorage.setItem("apuOrderRef", last);
  return `APU-${String(last).padStart(3, '0')}`;
}

/* -------------------- PAYMENT STATE -------------------- */
let pendingOrder = null;

const productCategories = {
  kits: [
    {name:"Animal First Aid Kit",price:65},
    {name:"Vehicle First Aid Kit",price:180},
    {name:"6 Man Boat First Aid Kit",price:180},
    {name:"Gun & Stab Wound First Aid Kit",price:200},
    {name:"Hikers First Aid Kit",price:325},
    {name:"Household First Aid Kit",price:450},
    {name:"ParaGear Tactical Pack - Basic (20 items)",price:480},
    {name:"Emergency Roadside Kit - Small (33 items)",price:850}
  ],
  onthego: [
    {name:"Travel On-The-Go Pack",price:150},
    {name:"Stings On-The-Go Pack",price:175},
    {name:"Eye Care On-The-Go Pack",price:175},
    {name:"CPR On-The-Go Pack",price:175}
  ],
  refills: [
    {name:"6 Man Boat Refill",price:80},
    {name:"Regulation 3 First Aid Refills",price:260},
    {name:"Regulation 7 First Aid Refills",price:null,onRequest:true},
    {name:"First Aid Box (wall mount or hand-held)",price:350}
  ],
  emergency: [
    // Trauma & Emergency items
    {name:"50mm Bandage",price:3.5},
    {name:"75mm Bandage",price:4},
    {name:"100mm Bandage",price:5},
    {name:"Sterile Gauze 75x75mm (5pc)",price:5},
    {name:"Cotton Wool Balls (5pc)",price:6.5},
    {name:"Gauze Pads 50x50mm (20pc)",price:15},
    {name:"CPR Face Shield / Mask",price:20},
    {name:"Elastic Adhesive Bandage 2,5cm X 4,5m",price:12,options:["BLACK","DARK ORANGE","WHITE","KHAKI","DARK PINK","PINK","YELLOW","GREEN","PURPLE","DARK BLUE","RED","TURQUOISE","BLUE","BROWN","DARK PURPLE","ORANGE"],optionLabel:"Color"},
    {name:"Elastic Adhesive Bandage 5cm x 4.5m",price:20,options:["BLACK","WHITE","KHAKI","DARK PINK","PINK","YELLOW","GREEN","NEON GREEN","PURPLE","RED","BLUE","ORANGE"],optionLabel:"Color"},
    {name:"Triangular Bandage",price:20},
    {name:"Adhesive Bandage",price:28},
    {name:"Gauze Pads 50x50mm (100pc)",price:30},
    {name:"Kaolin Hemostatic Gauze",price:60},
    // Consumables & Supplies
    {name:"5ml Syringe Luer Slip",price:1.45},
    {name:"10ml Syringe Luer Slip",price:2.20},
    {name:"Alcohol Swabs 10/packet",price:3.50},
    {name:"Gloves Single Pair Latex Powdered",price:4},
    {name:"Gloves Single Pair Latex Powder Free",price:5},
    {name:"Gloves pvc plastic 100pc",price:10},
    {name:"Cotton Earbuds (100pc)",price:15},
    {name:"Bro Wipes - 6 XL Wipes",price:18},
    {name:"Nitrile gloves - pack of 5 pairs",price:25,options:["M","L"],optionLabel:"Size"},
    {name:"Latex Gloves (20pc)",price:48,options:["S","M","L"],optionLabel:"Size"},
    {name:"Hi Care Medical Grade Nitrile Examination Gloves 100/box",price:110,options:["S","M","L"],optionLabel:"Size"},
    {name:"Healthease Nitrile Examination Gloves 100/box - Black",price:110,options:["S","M","L"],optionLabel:"Size"},
    {name:"5ml Syringe Luer Slip Box/100",price:135},
    {name:"10ml Syringe Luer Slip Box/100",price:190},
    {name:"10ml Syringe Luer Lock Box/100",price:200},
    // Pain & Cooling
    {name:"All Stings Considered Sachet",price:8},
    {name:"Instant Ice Pack",price:20},
    {name:"Cooling Patch",price:25},
    {name:"All Stings Considered Box",price:30},
    {name:"Burnshield Hydrogel 10ml",price:35},
    {name:"Deep Freeze Gel 35g",price:45},
    {name:"Deep Heat Rub 35g",price:65}
  ],
  tools: [
    {name:"Tweezers Stainless Steel",price:12},
    {name:"Outdoor Aluminum Clips",price:15,options:["GREY","TURQUOISE","GREEN","ORANGE","RED","BLACK"],optionLabel:"Clip Color"},
    {name:"Plastic Splint (Interlocking)",price:30},
    {name:"Elastic Tourniquet",price:30},
    {name:"Digital Thermometer - Soft Tip",price:40},
    {name:"First Aid Scissors 19cm",price:40},
    {name:"Pupil torch / silver",price:55},
    {name:"Elastic TQ belt holder",price:65},
    {name:"Finger Splints 2pc",price:null,onRequest:true},
    {name:"Paragear Military Tourniquet",price:140},
    {name:"Rescue Universal Scissors Plus Holster (6 in 1 Multitool)",price:850}
  ],
  plasters: [
    {name:"Plasterman - Non Woven Dressing 8x15cm",price:4.50},
    {name:"Extra long Boo Boo Plaster - 12cm (singles)",price:8},
    {name:"Breathable Dressing Pads (5pc) Approx 6x7cm",price:10},
    {name:"50pc AirStrip Plaster",price:25},
    {name:"Assorted Plasters Box 20pc (5 Different Sizes)",price:25},
    {name:"Neon Plasters Box 40pc",price:25},
    {name:"Non Woven Plaster 5cm x 5m",price:30}
  ],
  tattoo: [
    {name:"Alcohol Swabs 10/packet",price:3.50},
    {name:"Gloves Single Pair Latex Powdered",price:4},
    {name:"Plasterman - Non Woven Dressing 8x15cm",price:4.50},
    {name:"Gloves Single Pair Latex Powder Free",price:5},
    {name:"Sterile Gauze 75x75mm (5pc)",price:5},
    {name:"Cotton Wool Balls (5pc)",price:6.50},
    {name:"Gauze Pads 50x50mm (20pc)",price:15},
    {name:"Tweezers Stainless Steel",price:12},
    {name:"Elastic Adhesive Bandage 2,5cm X 4,5m",price:12,options:["BLACK","DARK ORANGE","WHITE","KHAKI","DARK PINK","PINK","YELLOW","GREEN","PURPLE","DARK BLUE","RED","TURQUOISE","BLUE","BROWN","DARK PURPLE","ORANGE"],optionLabel:"Color"},
    {name:"Cotton Earbuds (100pc)",price:15},
    {name:"Gloves pvc plastic 100pc",price:10},
    {name:"Adhesive Bandage",price:28},
    {name:"Non Woven Plaster 5cm x 5m",price:30},
    {name:"First Aid Scissors 19cm",price:40},
    {name:"Nitrile gloves - pack of 5 pairs",price:25,options:["M","L"],optionLabel:"Size"},
    {name:"Elastic Adhesive Bandage 5cm x 4.5m",price:20,options:["BLACK","WHITE","KHAKI","DARK PINK","PINK","YELLOW","GREEN","NEON GREEN","PURPLE","RED","BLUE","ORANGE"],optionLabel:"Color"},
    {name:"Bro Wipes - 6 XL Wipes",price:18},
    {name:"Gauze Pads 50x50mm (100pc)",price:30},
    {name:"Latex Gloves (20pc)",price:48,options:["S","M","L"],optionLabel:"Size"},
    {name:"Hi Care Medical Grade Nitrile Examination Gloves 100/box",price:110,options:["S","M","L"],optionLabel:"Size"},
    {name:"Healthease Nitrile Examination Gloves 100/box - Black",price:110,options:["S","M","L"],optionLabel:"Size"}
  ]
};

let cart=[];
let allCategories = ['kits', 'onthego', 'refills', 'emergency', 'tools', 'plasters', 'tattoo'];
let activeCategory = 'all';

// Image mapping
const imageMap = {
  "Animal First Aid Kit": "images/Animal first aid.png",
  "Vehicle First Aid Kit": "images/Vechle first aid kit.PNG",
  "Gun & Stab Wound First Aid Kit": "images/gun and stab kit.png",
  "Hikers First Aid Kit": "images/hikers first aid.PNG",
  "6 Man Boat First Aid Kit": "images/6 man boat kit.PNG",
  "6 Man Boat Refill": "images/6 man boat kit.PNG",
  "ParaGear Tactical Pack - Basic (20 items)": "images/para gear tac pac.PNG",
  "Household First Aid Kit": "images/Household kit.PNG",
  "Emergency Roadside Kit - Small (33 items)": "images/Roadside kit.PNG",
  "Travel On-The-Go Pack": "images/Travel On-The-Go Pack.PNG",
  "Stings On-The-Go Pack": "images/Stings on the go.PNG",
  "Eye Care On-The-Go Pack": "images/Eye care on the go.PNG",
  "CPR On-The-Go Pack": "images/CPR on the go.PNG",
  "Regulation 3 First Aid Refills": "images/Regulation 3 refill.PNG",
  "Regulation 7 First Aid Refills": "images/Regulation 7 refill.PNG",
  "CPR Face Shield / Mask": "images/CPR face sheild.PNG",
  "Plastic Splint (Interlocking)": "images/Splints interlocking.PNG",
  "Elastic Tourniquet": "images/Tournet elastic.PNG",
  "Burnshield Hydrogel 10ml": "images/burn 10ml hydrogel.PNG",
  "Paragear Military Tourniquet": "images/Tournet para gear.PNG",
  "Finger Splints 2pc": "images/Finger splint 2pc.PNG",
  "Triangular Bandage": "images/triangular bandage.PNG",
  "Gauze Pads 50x50mm (20pc)": "images/gauze 50x50 20pc.PNG",
  "Gauze Pads 50x50mm (100pc)": "images/gauze 50x50 100.PNG",
  "Sterile Gauze 75x75mm (5pc)": "images/75x75 sterile 5pc.PNG",
  "Kaolin Hemostatic Gauze": "images/hemostatic gauze.PNG",
  "Elastic Adhesive Bandage 5cm x 4.5m": "images/Athletic bandage.PNG",
  "Adhesive Bandage": "images/Elastic ad bandage.PNG",
  "50mm Bandage": "images/all sizes of bandages.PNG",
  "75mm Bandage": "images/all sizes of bandages.PNG",
  "100mm Bandage": "images/all sizes of bandages.PNG",
  "All Stings Considered Sachet": "images/All Stings Considered Sachet.PNG",
  "Cooling Patch": "images/Cooling patch.PNG",
  "All Stings Considered Box": "images/All Stings Considered Box.PNG",
  "Instant Ice Pack": "images/Ins ice pack.PNG",
  "Deep Freeze Gel 35g": "images/Deep Freeze Gel 35g.PNG",
  "Deep Heat Rub 35g": "images/Deep Heat Rub 35g.PNG",
  "Tweezers Stainless Steel": "images/Tweezers.PNG",
  "Pupil torch / silver": "images/pupil torch.PNG",
  "First Aid Scissors 19cm": "images/First aid scissors 19cm.PNG",
  "Rescue Universal Scissors Plus Holster (6 in 1 Multitool)": "images/Rescue uni scissors.PNG",
  "Plasterman - Non Woven Dressing 8x15cm": "images/Plasterman - Non Woven Dressing 8x15cm.png",
  "Breathable Dressing Pads (5pc) Approx 6x7cm": "images/Breathable Dressing Pads (5pc).PNG",
  "Assorted Plasters Box 20pc (5 Different Sizes)": "images/assorted plasters.PNG",
  "Neon Plasters Box 40pc": "images/neon plaster.PNG",
  "5ml Syringe Luer Slip": "images/5ml Syringe Luer Slip single.PNG",
  "10ml Syringe Luer Slip": "images/10ml Syringe Luer Slip single.PNG",
  "5ml Syringe Luer Slip Box/100": "images/5ml Syringe Luer Slip single.PNG",
  "10ml Syringe Luer Slip Box/100": "images/10ml Syringe Luer Slip single.PNG",
  "10ml Syringe Luer Lock Box/100": "images/10ml Syringe Luer Lock Box100.PNG",
  "Alcohol Swabs 10/packet": "images/Alcohol Swabs 10packet.PNG",
  "Gloves pvc plastic 100pc": "images/Gloves pvc plastic 100pc.png",
  "Gloves Single Pair Latex Powdered": "images/Gloves Single Pair Latex Powdered.PNG",
  "Healthease Nitrile Examination Gloves 100/box - Black": "images/Healthease Nitrile Examination Gloves 100box - Black.png",
  "Gloves Single Pair Latex Powder Free": "images/Gloves Single Pair Latex Powder Free.PNG",
  "Latex Gloves (20pc)": "images/Latex Gloves (20pc).PNG",
  "Cotton Wool Balls (5pc)": "images/Cotton Wool Balls (5pc).PNG",
  "Cotton Earbuds (100pc)": "images/Cotton Earbuds (100pc).PNG",
  "Hi Care Medical Grade Nitrile Examination Gloves 100/box": "images/Nitrile Examination Gloves 100 box.PNG",
  "Digital Thermometer - Soft Tip": "images/Digital Thermometer - Soft Tip.png",
  "Bro Wipes - 6 XL Wipes": "images/Bro Wipes - 6 XL Wipes.png",
  "Nitrile gloves - pack of 5 pairs": "images/Nitrile gloves - pack of 5 pairs.png",
  "50pc AirStrip Plaster": "images/50pc airstrip plaster.png",
  "Elastic Adhesive Bandage 2,5cm X 4,5m": "images/Adhesive Bandage 2.5cm x 4.5m.png",
  "Elastic TQ belt holder": "images/Elastic TQ belt holder.png",
  "Extra long Boo Boo Plaster - 12cm (singles)": "images/Extra long Boo Boo plaster - 12cm.png",
  "First Aid Box (wall mount or hand-held)": "images/First aid box.png",
  "Non Woven Plaster 5cm x 5m": "images/Non woven plaster - 5cm x 5m.png",
  "Outdoor Aluminum Clips": "images/Outdoor Aluminum Clips.png"
};

function getProductImage(productName){
  return imageMap[productName] || "https://images.unsplash.com/photo-1580281657521-12a6c38d5b00?auto=format&fit=crop&w=600&q=60";
}

const cartEl=document.getElementById("cart");
const cartItems=document.getElementById("cartItems");
const totalEl=document.getElementById("total");
const warningEl=document.getElementById("warning");
const searchInput = document.getElementById("searchInput");

searchInput.addEventListener('input', filterProducts);

function filterProducts(){
  const query = searchInput.value.toLowerCase();
  
  if(!query){
    if(activeCategory === 'all'){
      renderAllProducts();
    } else {
      filterByCategory(activeCategory);
    }
    return;
  }
  
  allCategories.forEach(cat => {
    const filtered = productCategories[cat].filter(p => 
      p.name.toLowerCase().includes(query)
    );
    
    const containerId = getCategoryContainerId(cat);
    const container = document.getElementById(containerId);
    
    // Show category only if it matches search AND (no category filter OR category filter matches)
    if(filtered.length > 0 && (activeCategory === 'all' || activeCategory === cat)){
      renderProducts(filtered, containerId, cat);
      container.parentElement.style.display = 'block';
    } else {
      container.parentElement.style.display = 'none';
    }
  });
}

function getCategoryContainerId(cat){
  const map = {
    'kits': 'kitsList',
    'onthego': 'onTheGoList',
    'refills': 'refillsList',
    'emergency': 'emergencyList',
    'tools': 'toolsList',
    'plasters': 'plastersList',
    'tattoo': 'tattooList'
  };
  return map[cat];
}

function clearSearch(){
  searchInput.value = '';
  activeCategory = 'all';
  updateCategoryButtons();
  renderAllProducts();
}

function filterByCategory(category){
  activeCategory = category;
  searchInput.value = '';
  updateCategoryButtons();
  
  if(category === 'all'){
    renderAllProducts();
  } else if(category === 'tattoo'){
    // Hide all regular categories and show only tattoo
    allCategories.forEach(cat => {
      const containerId = getCategoryContainerId(cat);
      const container = document.getElementById(containerId);
      container.parentElement.style.display = 'none';
    });
    document.getElementById('tattooSection').style.display = 'block';
    renderProductCategory('tattoo', 'tattooList');
  } else {
    allCategories.forEach(cat => {
      const containerId = getCategoryContainerId(cat);
      const container = document.getElementById(containerId);
      container.parentElement.style.display = cat === category ? 'block' : 'none';
    });
    document.getElementById('tattooSection').style.display = 'none';
    renderProductCategory(category, getCategoryContainerId(category));
  }
}

function updateCategoryButtons(){
  const buttons = document.querySelectorAll('.category-btn');
  buttons.forEach(btn => {
    btn.classList.remove('active-cat');
    btn.style.background = '#e2e8f0';
    btn.style.color = '#334155';
  });
  
  const activeBtn = Array.from(buttons).find(btn => {
    const text = btn.textContent.trim().toLowerCase();
    const catMap = {
      'all': activeCategory === 'all',
      'üéí first aid kits': activeCategory === 'kits',
      'üèÉ on-the-go': activeCategory === 'onthego',
      'üìã refills': activeCategory === 'refills',
      'üöë disposable & emergency': activeCategory === 'emergency',
      'üîß tools': activeCategory === 'tools',
      'ü©π plasters': activeCategory === 'plasters',
      'üé® tattoo supplies': activeCategory === 'tattoo'
    };
    return catMap[text];
  });
  
  if(activeBtn){
    activeBtn.classList.add('active-cat');
    activeBtn.style.background = '#0ea5a4';
    activeBtn.style.color = '#ffffff';
  }
}

function toggleCart(){cartEl.classList.toggle("active")}

function openCart(){cartEl.classList.add("active")}

function closeCart(){cartEl.classList.remove("active")}

function toggleCategory(header){
  const toggle = header.querySelector('.category-toggle');
  const products = header.nextElementSibling;
  toggle.classList.toggle('active');
  products.classList.toggle('collapsed');
}

function renderProducts(products, containerId, categoryKey){
  const container = document.getElementById(containerId);
  const isOnTheGo = containerId.includes('onthego') || categoryKey === 'onthego';
  const isEmergency = containerId.includes('emergency') || categoryKey === 'emergency';
  const isRefill = containerId.includes('refill') || categoryKey === 'refills';
  const isKit = containerId.includes('kits') || categoryKey === 'kits';
  const isPlaster = containerId.includes('plasters') || categoryKey === 'plasters';
  
  container.innerHTML = products.map((p, idx) => {
    const productId = `${containerId}-${idx}`;
    let priceDisplay = p.onRequest ? "Price on Request" : `R${p.price.toFixed(2)}`;
    const imageUrl = getProductImage(p.name);
    let productClass = 'product';
    if(isOnTheGo) productClass += ' onthego-item';
    if(isEmergency) productClass += ' emergency-item';
    if(isRefill) productClass += ' refill-item';
    if(isKit) productClass += ' kit-item';
    if(isPlaster) productClass += ' plaster-item';
    let productHTML = `
      <div class="${productClass}" data-category="${categoryKey}" data-idx="${idx}" style="position:relative;padding-top:8px">
        <img src="${imageUrl}" alt="${p.name}">
        <h4>${p.name}</h4>
        <strong>${priceDisplay}</strong>`;
    
    if(p.options && p.options.length > 0){
      productHTML += `
        <select id="${productId}-select" style="width:100%;padding:8px;border:1px solid #e2e8f0;border-radius:6px;margin-top:10px">
          <option value="">Choose ${p.optionLabel || "Option"}...</option>`;
      p.options.forEach(opt => {
        productHTML += `<option value="${opt}">${opt}</option>`;
      });
      productHTML += `</select>`;
    }
    
    if(!p.onRequest){
      productHTML += `<button class="btn" id="btn-${productId}" onclick="addToCartWithOption('${productId}', '${p.name}', ${p.price})">Add to Cart</button>`;
    } else {
      productHTML += `<button class="btn" onclick="alert('Please contact us for pricing')">Inquire</button>`;
    }

    // Show description button for kits, refills and on-the-go
    if(isKit || isRefill || isOnTheGo){
      productHTML += `<button class="desc-btn" onclick="showItemModal('${categoryKey}', ${idx})" style="position:absolute;top:8px;right:8px;background:rgba(14,165,164,0.85);color:#ffffff;border:none;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600">whats inside</button>`;
    }
    
    productHTML += `</div>`;
    return productHTML;
  }).join("");
}

function renderAllProducts(){
  // Show all regular categories, hide tattoo
  allCategories.forEach(cat => {
    if(cat !== 'tattoo'){
      const containerId = getCategoryContainerId(cat);
      const container = document.getElementById(containerId);
      container.parentElement.style.display = 'block';
    }
  });
  document.getElementById('tattooSection').style.display = 'none';
  
  renderProductCategory('kits', 'kitsList');
  renderProductCategory('onthego', 'onTheGoList');
  renderProductCategory('refills', 'refillsList');
  renderProductCategory('emergency', 'emergencyList');
  renderProductCategory('tools', 'toolsList');
  renderProductCategory('plasters', 'plastersList');
}

function renderProductCategory(categoryKey, containerId){
  const products = productCategories[categoryKey];
  renderProducts(products, containerId, categoryKey);
}

function addToCartWithOption(productId, name, price){
  const btn = document.getElementById(`btn-${productId}`);
  if(btn){
    const originalText = btn.textContent;
    btn.textContent = '‚è≥ Adding...';
    btn.disabled = true;
    btn.style.opacity = '0.6';
  }

  const selectElement = document.getElementById(`${productId}-select`);
  const selectedOption = selectElement ? selectElement.value : null;
  
  if(selectElement && !selectedOption){
    alert('Please select an option');
    if(btn){
      btn.textContent = 'Add to Cart';
      btn.disabled = false;
      btn.style.opacity = '1';
    }
    return;
  }
  
  let cartItemName = name;
  let itemPrice = price;
  
  if(selectedOption){
    cartItemName = `${name} (${selectedOption})`;
    if(selectedOption.includes('Lock')){
      itemPrice = 200;
    } else if(selectedOption.includes('R190')){
      itemPrice = 190;
    }
  }
  
  const ex = cart.find(x => x.name === cartItemName);
  if(ex) ex.qty++;
  else cart.push({name: cartItemName, price: itemPrice, qty: 1});
  
  renderCart();
  openCart();

  if(btn){
    setTimeout(() => {
      btn.textContent = 'Add to Cart';
      btn.disabled = false;
      btn.style.opacity = '1';
    }, 600);
  }
}

function renderCart(){
  let total=0;
  cartItems.innerHTML=cart.map((i,idx)=>{
    const sub=i.qty*i.price; total+=sub;
    return `<div class="cart-item">
      <div class="cart-item-info"><strong>${i.qty}x</strong> ${i.name} ‚Äî <span style="color:#14b8a6">R${sub.toFixed(2)}</span></div>
      <div style="display:flex;gap:6px;align-items:center">
        <button style="width:28px;height:28px;padding:0;background:#e2e8f0;border:none;border-radius:4px;cursor:pointer;font-weight:bold;color:#334155;transition:.2s" onmouseover="this.style.background='#cbd5e1'" onmouseout="this.style.background='#e2e8f0'" onclick="decreaseQty(${idx})">‚àí</button>
        <button style="width:28px;height:28px;padding:0;background:#e2e8f0;border:none;border-radius:4px;cursor:pointer;font-weight:bold;color:#334155;transition:.2s" onmouseover="this.style.background='#cbd5e1'" onmouseout="this.style.background='#e2e8f0'" onclick="increaseQty(${idx})">+</button>
        <button class="delete-btn" onclick="removeFromCart(${idx})">Delete</button>
      </div>
    </div>`;
  }).join("");
  totalEl.textContent=total.toFixed(2);
  warningEl.textContent=total<MIN_ORDER?`Minimum order is R${MIN_ORDER}`:"";
}

function increaseQty(idx){
  cart[idx].qty++;
  renderCart();
}

function decreaseQty(idx){
  if(cart[idx].qty>1) cart[idx].qty--;
  else removeFromCart(idx);
  renderCart();
}

function removeFromCart(idx){
  cart.splice(idx,1);
  renderCart();
}

function openDeliveryForm(){
  const total=cart.reduce((s,i)=>s+i.price*i.qty,0);
  if(total<MIN_ORDER){warningEl.textContent=`Minimum order is R${MIN_ORDER}`;return;}
  document.getElementById('deliveryModal').style.display='flex';
}

function closeDeliveryForm(){
  document.getElementById('deliveryModal').style.display='none';
  document.getElementById('deliveryWarning').textContent='';
}

// Contents map for kits/refills details
const contentsMap = {
  "Animal First Aid Kit": {
    items: [
      {name: "Gloves Single Pair Latex Powder Free", qty: 1},
      {name: "Sample/Vomit Bag", qty: 1},
      {name: "Sterile Gauze 75x75mm (5pc)", qty: 1},
      {name: "10ml Syringe Luer Slip", qty: 1},
      {name: "Activated Charcoal 10g", qty: 1},
      {name: "75mm Bandage", qty: 1},
      {name: "Tongue Depressor", qty: 2}
    ],
    description: "Basic animal first aid kit contents."
  },

  "Vehicle First Aid Kit": {
    items: [
      {name: "First Aid Kit Hard Case (Red)", qty: 1},
      {name: "Silver Emergency Blanket", qty: 1},
      {name: "Instant Ice Pack (100 g)", qty: 1},
      {name: "Conforming Bandage (roll)", qty: 1},
      {name: "Cleansing Wipe Pads (pkt)", qty: 2},
      {name: "Alcohol Pads (pkt)", qty: 10},
      {name: "Stainless Steel Saber Card", qty: 1},
      {name: "Sterile Gauze Pads (pkt)", qty: 2},
      {name: "Triangular Bandage", qty: 1},
      {name: "Band-aids (pkt)", qty: 10},
      {name: "Hand-pressing Flashlight", qty: 1},
      {name: "First Aid Guide", qty: 1},
      {name: "Tourniquet (roll)", qty: 1},
      {name: "Tweezers", qty: 1},
      {name: "Aluminum Alloy Whistle", qty: 1},
      {name: "First Aid Tape (roll)", qty: 1},
      {name: "Safety Pins", qty: 10},
      {name: "Scissors", qty: 1}
    ],
    description: "Standard vehicle first aid kit contents."
  },

  "6 Man Boat First Aid Kit": {
    items: [
      {name: "CPR Mouth Piece", qty: 1},
      {name: "Triangular Bandages Non-Woven", qty: 1},
      {name: "Examination Gloves - Large (pairs)", qty: 2},
      {name: "Safety Pins - 10/Set", qty: 1},
      {name: "Conforming Bandages 75mm", qty: 2},
      {name: "Conforming Bandages 50mm", qty: 2},
      {name: "Metal Tweezer", qty: 1},
      {name: "Plaster Strips - Washproof", qty: 10},
      {name: "Cotton Wool Balls - 5g", qty: 1},
      {name: "Antiseptic Solution 100ml", qty: 1},
      {name: "Scissors - First Aid - 10cm", qty: 1},
      {name: "First Aid Dressing No. 2", qty: 1},
      {name: "First Aid Dressing No. 5", qty: 1},
      {name: "Paracetamol Tablets 10's", qty: 1},
      {name: "Clear PVC Bag", qty: 1}
    ],
    description: "6-man boat kit contents."
  },

  "6 Man Boat Refill": {
    items: [
      {name: "CPR Mouth Piece", qty: 1},
      {name: "Triangular Bandages Non-Woven", qty: 1},
      {name: "Examination Gloves - Large (pairs)", qty: 2},
      {name: "Safety Pins - 10/Set", qty: 1},
      {name: "Conforming Bandages 75mm", qty: 2},
      {name: "Conforming Bandages 50mm", qty: 2},
      {name: "Metal Tweezer", qty: 1},
      {name: "Plaster Strips - Washproof", qty: 10},
      {name: "Cotton Wool Balls - 5g", qty: 1},
      {name: "Antiseptic Solution 100ml", qty: 1},
      {name: "Scissors - First Aid - 10cm", qty: 1},
      {name: "First Aid Dressing No. 2", qty: 1},
      {name: "First Aid Dressing No. 5", qty: 1},
      {name: "Paracetamol Tablets 10's", qty: 1}
    ],
    description: "Same contents as the 6-man boat kit."
  },

  "Gun & Stab Wound First Aid Kit": {
    items: [
      {name: "Chest Wound Seal (Flutter Valve Type)", qty: 1},
      {name: "CPR Mouth Piece", qty: 1},
      {name: "Triangular Bandages Non-Woven", qty: 2},
      {name: "Examination Gloves - Large (pairs)", qty: 2},
      {name: "Antiseptic Solution 100ml", qty: 1},
      {name: "Plaster Roll 25mm x 3m", qty: 1},
      {name: "Gauze Swabs 75mm x 75mm Sterile 5's", qty: 1},
      {name: "Scissors - First Aid - 16cm", qty: 1},
      {name: "First Aid Dressing No. 2", qty: 2},
      {name: "First Aid Dressing No. 3", qty: 2},
      {name: "First Aid Dressing No. 5", qty: 2},
      {name: "Cotton Wool Balls 5g", qty: 1},
      {name: "Clear PVC Bag", qty: 1}
    ],
    description: "Gun & stab wound kit contents."
  },

  "Hikers First Aid Kit": {
    items: [
      {name: "Antiseptic Cream - Cetrimide - 25g", qty: 1},
      {name: "Conforming Bandage 75mm", qty: 1},
      {name: "CPR Mouth Piece", qty: 1},
      {name: "Cotton Wool Balls 5g", qty: 1},
      {name: "First Aid Dressing No. 3", qty: 1},
      {name: "Gauze Swabs 75x75mm Sterile", qty: 1},
      {name: "Examination Gloves (pair)", qty: 1},
      {name: "Lip Care", qty: 1},
      {name: "Paracetamol Tablets 10's", qty: 1},
      {name: "Fabric Plaster Strips", qty: 10},
      {name: "Rescue Blanket - Adult", qty: 1},
      {name: "Burns Dressing 10x10cm", qty: 1},
      {name: "First Aid Scissor 10cm", qty: 1},
      {name: "Safety Pins 12's", qty: 1},
      {name: "Metal First Aid Tweezer", qty: 1},
      {name: "Sunblock Sachet", qty: 1},
      {name: "Triangular Bandage - Disposable", qty: 1},
      {name: "Water Purification Tablets", qty: 10}
    ],
    description: "Hiker-specific compact kit."
  },

  "Household First Aid Kit": {
    items: [
      {name: "Burnshield Hydrogel Sachet 3.5ml", qty: 3},
      {name: "Burnshield Hydrogel Tube 25ml", qty: 1},
      {name: "Burnshield Dressing 100x100mm", qty: 1},
      {name: "Antiseptic Cleansing Wipes", qty: 3},
      {name: "CPR Mouthpiece", qty: 1},
      {name: "Eye Pad", qty: 1},
      {name: "Eye Shield", qty: 1},
      {name: "Pair of Gloves", qty: 1},
      {name: "Sterile Gauze 75x75mm", qty: 2},
      {name: "Plastic Tape 25mm x 5m", qty: 1},
      {name: "Rescue Blanket", qty: 1},
      {name: "First Aid Scissors", qty: 1},
      {name: "Triangular Bandage", qty: 2},
      {name: "Conform Bandage 50mm", qty: 2},
      {name: "Conform Bandage 75mm", qty: 1},
      {name: "Crepe Bandage 50mm", qty: 1},
      {name: "FAD No.2", qty: 3},
      {name: "FAD No.3", qty: 3},
      {name: "FAD No.5", qty: 1},
      {name: "Anchor Plasters", qty: 5},
      {name: "Waterproof Plasters", qty: 20},
      {name: "Wound Closure Strip", qty: 1},
      {name: "Fabric Roll 25mm x 3m", qty: 1},
      {name: "Metal Forceps", qty: 1},
      {name: "Safety Pins", qty: 1},
      {name: "Post Op Non Woven Wound Dressing + Pad", qty: 2},
      {name: "Burnshield Pocket Guide", qty: 1}
    ],
    description: "Comprehensive household first aid kit contents."
  },

  "ParaGear Tactical Pack - Basic (20 items)": {
    items: [
      {name: "ParaGear Tactical/Military Rotation Tourniquet", qty: 1},
      {name: "Emergency Trauma Hemorrhage Control Bandage", qty: 1},
      {name: "Black Nitrile Examination Gloves - Pair", qty: 1},
      {name: "Rescue/Space Blanket (Adult)", qty: 1},
      {name: "Rescue Scissors - 19cm", qty: 1},
      {name: "CPR Mouth Piece", qty: 1},
      {name: "Transparent Tape 12mm x 5m", qty: 1},
      {name: "Crepe Bandage 75mm", qty: 1},
      {name: "Single Loop Eye Pad", qty: 1},
      {name: "Trauma Pad 10x20cm", qty: 2},
      {name: "Triangular Bandage - Non-Woven", qty: 1},
      {name: "Burn Blott 3.5ml Sachet", qty: 1},
      {name: "Safety Pins - 12/Bunch", qty: 1},
      {name: "Non-Woven Sterile Gauze Swabs 100x100mm", qty: 1},
      {name: "Nasopharyngeal Airway FG28", qty: 1},
      {name: "Optilube Sachet 2.7g", qty: 1},
      {name: "Wooden Tongue Depressor", qty: 1},
      {name: "Surgical Skin Marking Pen", qty: 1}
    ],
    description: "Tactical pack contents."
  },

  "Emergency Roadside Kit - Small (33 items)": {
    items: [
      {name: "Conforming Bandage 50mm", qty: 1},
      {name: "Burns Dressing 10x10cm", qty: 1},
      {name: "CPR Mouth Piece", qty: 1},
      {name: "Eye Drop Vials 0.4ml", qty: 2},
      {name: "First Aid Dressing No. 2", qty: 1},
      {name: "First Aid Dressing No. 3", qty: 1},
      {name: "Gauze Swabs 75x75mm Sterile 5's", qty: 1},
      {name: "Gentian Violet 20ml", qty: 1},
      {name: "Examination Gloves (Pair)", qty: 1},
      {name: "Fabric Plaster Strips", qty: 10},
      {name: "Safety Pins 12's", qty: 1},
      {name: "First Aid Scissors 10cm", qty: 1},
      {name: "Triangular Bandage Disposable", qty: 2},
      {name: "Metal First Aid Tweezer", qty: 1},
      {name: "Antiseptic Solution 50ml", qty: 1},
      {name: "Jumper Cables", qty: 1},
      {name: "Tow Rope", qty: 1},
      {name: "Tyre Weld", qty: 1},
      {name: "Q20 Spray 150g", qty: 1}
    ],
    description: "Roadside emergency kit contents."
  },

  "Stings On-The-Go Pack": {
    items: [
      {name: "Sting-Bee-Gone", qty: 1},
      {name: "Tweezers Stainless Steel", qty: 1},
      {name: "Antiseptic Cleansing Wipes", qty: 5},
      {name: "Assorted Plasters Box 20pc (5 Different Sizes)", qty: 5},
      {name: "Instant Ice Pack", qty: 1},
      {name: "Crepe Bandage 75mm", qty: 2},
      {name: "Gloves Single Pair Latex Powder Free", qty: 1}
    ],
    description: "Sting relief on-the-go pack."
  },

    "Travel On-The-Go Pack": {
    items: [
      {name: "3-Ply Face Masks", qty: 3},
      {name: "Gloves Pairs", qty: 2},
      {name: "Clinell Hand Sanitizer Gel", qty: 1},
      {name: "Clinell Bed Bath Wipes", qty: 1},
      {name: "Clinell Antibacterial Hand Wipes", qty: 1},
    ],
    description: "Travel-friendly on-the-go pack with essentials for minor injuries and emergencies while on the move."
  },

  "Eye Care On-The-Go Pack": {
    items: [
      {name: "Eye Wash Bottle", qty: 1},
      {name: "10ml Saline Pod", qty: 2},
      {name: "Eye Bath", qty: 1},
      {name: "Single Eye Pad", qty: 2},
      {name: "Eye Shield", qty: 1},
      {name: "Gloves Single Pair Latex Powder Free", qty: 1}
    ],
    description: "Eye care on-the-go pack."
  },

  "CPR On-The-Go Pack": {
    items: [
      {name: "CPR Face Shield / Mask", qty: 1},
      {name: "Gloves Single Pair Latex Powder Free", qty: 1},
      {name: "Alcohol Swabs 10/packet", qty: 1},
      {name: "Quick reference guide", qty: 1}
    ],
    description: "CPR resuscitation on-the-go pack."
  },

  "Regulation 3 First Aid Refills": {
    items: [
      {name: "CPR Mouth Piece", qty: 2},
      {name: "Microporous Paper Tape 25mm x 3m", qty: 1},
      {name: "Triangular Bandages Non-Woven", qty: 4},
      {name: "Examination Gloves - Large (pairs)", qty: 2},
      {name: "Examination Gloves - Medium (pairs)", qty: 2},
      {name: "Safety Pins - 10/Set", qty: 1},
      {name: "Conforming Bandages 75mm", qty: 4},
      {name: "Conforming Bandages 100mm", qty: 4},
      {name: "Tweezers", qty: 1},
      {name: "Plaster Strips (Standard) 19mm x 76mm", qty: 10},
      {name: "Cotton Wool Roll (For Splinting)", qty: 1},
      {name: "Antiseptic Solution 100ml", qty: 1},
      {name: "Scissors - First Aid - 10cm", qty: 1},
      {name: "Wooden Splints - Pair", qty: 1},
      {name: "First Aid Dressing No. 3", qty: 4},
      {name: "First Aid Dressing No. 5", qty: 4},
      {name: "Gauze Swabs 100mm x 100mm (Sterile) 5/Pouch", qty: 2},
      {name: "Swabs Non-Woven 50mm x 50mm (100/Pack)", qty: 1},
      {name: "Plaster Roll - 25mm x 3m", qty: 1},
      {name: "Burns Dressing 10cm x 10cm", qty: 1}
    ],
    description: "Regulation 3 First Aid refill contents."
  },

  "First Aid Box (wall mount or hand-held)": {
    items: [
      {name: "Keys for the box", qty: 2},
      {name: "screws for wallmount", qty: 2},
    ],
    description: "This is the box only, without contents. Suitable for wall mounting or hand-held use. Please note that the box does not include any first aid items, it's just the container to hold your supplies."
    }
};

function showItemModal(categoryKey, idx){
  const product = productCategories[categoryKey] && productCategories[categoryKey][idx];
  if(!product) return;
  const titleEl = document.getElementById('itemModalTitle');
  const countEl = document.getElementById('itemModalCount');
  const listEl = document.getElementById('itemModalList');
  const descEl = document.getElementById('itemModalDesc');

  titleEl.textContent = product.name;
  listEl.innerHTML = '';

  const info = contentsMap[product.name];
  if(info && Array.isArray(info.items)){
    let total = 0;
    info.items.forEach(it => {
      total += (it.qty||1);
      const row = document.createElement('div');
      row.innerHTML = `<strong>${it.qty}x</strong> ${it.name}`;
      row.style.fontSize = '0.95rem';
      row.style.lineHeight = '1.2';
      listEl.appendChild(row);
    });
    countEl.textContent = `Total items: ${total}`;
    descEl.textContent = info.description || '';
  } else {
    countEl.textContent = '';
    descEl.textContent = info && info.description ? info.description : 'Contents list will be available soon.';
  }

  // store current modal product for add-to-cart
  document.getElementById('itemModal').dataset.category = categoryKey;
  document.getElementById('itemModal').dataset.idx = idx;
  // show main product image
  const mainImg = document.getElementById('itemModalMainImage');
  if(mainImg){
    mainImg.src = getProductImage(product.name);
    mainImg.alt = product.name;
  }

  document.getElementById('itemModal').style.display = 'flex';
}

function closeItemModal(){
  document.getElementById('itemModal').style.display = 'none';
}

function addToCartFromModal(){
  const modal = document.getElementById('itemModal');
  const categoryKey = modal.dataset.category;
  const idx = parseInt(modal.dataset.idx,10);
  const product = productCategories[categoryKey] && productCategories[categoryKey][idx];
  if(!product) return;
  if(product.onRequest || product.price === null){
    alert('This item is available on request. Please contact us for pricing.');
    return;
  }
  const ex = cart.find(x => x.name === product.name);
  if(ex) ex.qty++; else cart.push({name: product.name, price: product.price, qty:1});
  renderCart();
  // On mobile, keep behavior: open cart so user sees item
  openCart();
  closeItemModal();
}

function isMnandiArea(postal,area){
  postal=postal.trim().toLowerCase();
  area=area.trim().toLowerCase();
  return postal==='0157' || area.includes('knoppieslaagte');
}

function updateDeliveryEstimate(){
  const delivery=document.querySelector('input[name="delivery"]:checked')?.value;
  const estimate=document.getElementById('courierEstimate');
  if(delivery==='courier'){
    estimate.style.display='block';
  }else{
    estimate.style.display='none';
  }
}

function getCourierFee(postal,area){
  if(isMnandiArea(postal,area)) return 50;
  return 100;
}

function submitDelivery(){
  const name=document.getElementById('deliveryName').value.trim();
  const phone=document.getElementById('deliveryPhone').value.trim();
  const address=document.getElementById('deliveryAddress').value.trim();
  const postal=document.getElementById('deliveryPostal').value.trim();
  const area=document.getElementById('deliveryArea').value.trim();
  const delivery=document.querySelector('input[name="delivery"]:checked')?.value;
  const warning=document.getElementById('deliveryWarning');

  warning.textContent='';
  if(!name||!phone||!address||!postal||!delivery){
    warning.textContent='Please fill all required fields';
    return;
  }

  const subtotal=cart.reduce((s,i)=>s+i.price*i.qty,0);
  let fee=0,deliveryText='';

  if(delivery==='pickup'){
    fee=0;
    deliveryText='üìç PICK-UP (Free) - 924 London Lane, Knoppieslaagte';
  }else if(delivery==='courier'){
    fee=getCourierFee(postal,area);
    deliveryText=`üì¶ COURIER DELIVERY (R${fee})`;
  }

  const finalTotal=subtotal+fee;

  // Check minimum order
  if(finalTotal<80){
    warning.textContent='Minimum order is R80. Current total: R'+finalTotal.toFixed(2);
    warning.style.color='#ef4444';
    return;
  }

  // Show loading state
  warning.textContent='Processing payment...';
  warning.style.color='#0ea5a4';

  // Prepare data for backend
  const paymentData={
    cart:cart,
    total:finalTotal,
    customer:{
      name:name,
      phone:phone,
      address:address,
      postal:postal,
      area:area
    },
    deliveryInfo:deliveryText
  };

  // Send to PHP backend first to create order
  fetch('./process_payment_live.php',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(paymentData)
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.success && data.whatsapp_url){
      // Close form
      closeDeliveryForm();
      
      // Clear cart after order sent
      cart = [];
      renderCart();
      
      // Open WhatsApp with order details and Yoco payment link
      // Use window.location.href for better mobile support
      window.location.href = data.whatsapp_url;
    }else{
      warning.textContent='Error: '+(data.error || 'Unknown error');
      warning.style.color='#ef4444';
    }
  })
  .catch(err=>{
    warning.textContent='Error: '+err.message;
    warning.style.color='#ef4444';
  });
}

function checkout(){
  // Close cart first so delivery form is visible on mobile
  closeCart();
  openDeliveryForm();
}

renderAllProducts();
updateCategoryButtons();

</script>

</body>
</html>
